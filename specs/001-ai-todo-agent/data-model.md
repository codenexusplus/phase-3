# Data Model: AI Todo Agentic System

## Overview
This document defines the data models for the AI Todo Agentic System, including database schemas, relationships, and validation rules based on the feature specification and constitutional requirements.

## Entity: Task
Represents a todo item with unique identifier, user identifier, title, description, and completion status.

### Fields
- `id` (Integer, Primary Key, Auto-increment)
  - Unique identifier for the task
  - Auto-generated by the database
- `user_id` (String/UUID, Indexed)
  - Foreign key linking the task to a specific user
  - Required for data isolation between users
  - Indexed for performance
- `title` (String, Max 255 characters)
  - Brief title of the task
  - Required field
- `description` (Text, Optional)
  - Detailed description of the task
  - Optional field
- `completed` (Boolean)
  - Status indicating if the task is completed
  - Default: False
- `created_at` (DateTime)
  - Timestamp when the task was created
  - Auto-populated
- `updated_at` (DateTime)
  - Timestamp when the task was last updated
  - Auto-populated and updated

### Relationships
- Belongs to one `User` (via user_id foreign key)
- Part of one `Conversation` (via association through messages)

### Validation Rules
- `title` is required and must be between 1-255 characters
- `user_id` is required and must correspond to an existing user
- All database queries must include WHERE user_id = :user_id for data isolation

## Entity: Conversation
Groups related messages between user and AI assistant, associated with a specific user.

### Fields
- `id` (Integer, Primary Key, Auto-increment)
  - Unique identifier for the conversation
  - Auto-generated by the database
- `user_id` (String/UUID, Indexed)
  - Foreign key linking the conversation to a specific user
  - Required for data isolation between users
  - Indexed for performance
- `created_at` (DateTime)
  - Timestamp when the conversation was started
  - Auto-populated
- `updated_at` (DateTime)
  - Timestamp when the conversation was last updated
  - Auto-populated and updated

### Relationships
- Belongs to one `User` (via user_id foreign key)
- Has many `Message` entities

### Validation Rules
- `user_id` is required and must correspond to an existing user
- All database queries must include WHERE user_id = :user_id for data isolation

## Entity: Message
Stores individual chat history entries with content, role (user/assistant), timestamp, and conversation identifier.

### Fields
- `id` (Integer, Primary Key, Auto-increment)
  - Unique identifier for the message
  - Auto-generated by the database
- `conversation_id` (Integer, Foreign Key)
  - Links the message to a specific conversation
  - Required field
- `role` (String, Enum: 'user'/'assistant')
  - Indicates whether the message is from the user or the AI assistant
  - Required field
- `content` (Text)
  - The actual content of the message
  - Required field
- `created_at` (DateTime)
  - Timestamp when the message was created
  - Auto-populated

### Relationships
- Belongs to one `Conversation` (via conversation_id foreign key)

### Validation Rules
- `conversation_id` is required and must correspond to an existing conversation
- `role` must be either 'user' or 'assistant'
- `content` is required and must not be empty

## Constitutional Compliance
All entities implement the security and privacy requirements from the constitution:
- Every SQL query must include WHERE user_id = :user_id clause to prevent data leakage between users
- Proper tenancy is maintained through the user_id field in Task and Conversation entities
- The Message entity maintains privacy through its relationship with Conversation which is tied to a specific user